{% extends "layout.html" %}
{% block content %}

<div class="panel-group">  
	<div class="panel panel-info">
		<div class="panel-heading">
			<h3 class="panel-title">
				<a data-toggle="collapse" id="showFiltres" href="#filtres">Filtres</a>

			</h3>
		</div>
		<div id="filtres" class="panel-collapse collapse">

			<div class="panel-body">

				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" id="categories" href="#tabCategories">Catégories</a></li>
					<li><a data-toggle="tab" id="villes" href="#tabVilles">Villes</a></li>
					<li><a data-toggle="tab" id="quantumDemande" href="#tabQuantumDemande">Quantum demandé</a></li>
					<li><a data-toggle="tab" id="quantumResultat" href="#tabQuantumResultat">Quantum resultat</a></li>
					<li><a data-toggle="tab" id="resultats" href="#tabResultats">Resultats</a></li>

				</ul>

				<div class="tab-content">
					<div id="tabCategories" class="tab-pane fade in active">
						<div class="btn-group selection">
							<button id="selectAll" type="button" class="btn btn-sm btn-info">Tout sélectionner</button>
							<button  id="deselectAll" type="button" class="btn btn-sm btn-info">Tout désélectionner</button>
						</div>
						<div class="categories">
							{% for c in categories %}
							<div class="categories checkbox">
								<label><input type="checkbox" value="{{c[0]}}">{{c[0]}}</label>
							</div>
							{% endfor %}

						</div>
						<button type="button" id="searchByCategory" class="btn btn-primary search">Rechercher</button>	
					</div>
					<div id="tabVilles" class="tab-pane fade">
						<div class="btn-group selection">
							<button id="selectAllV" type="button" class="btn btn-sm btn-info">Tout sélectionner</button>
							<button  id="deselectAllV" type="button" class="btn btn-sm btn-info">Tout désélectionner</button>
						</div>
						<div class="villes">
							{% for v in villes %}
							<div class="villes checkbox">
								<label><input type="checkbox" name="ville" value="{{v[0]}}">{{v[0]}}</label>
							</div>
							{% endfor %}

						</div>
						<button id="searchByCity" type="button" class="btn btn-primary search">Rechercher</button>

					</div>
					<div id="tabQuantumDemande" class="tab-pane fade">
						<br>
						<form class="form-inline">
							<div class="form-group">
								<label class="sr-only"></label>
								<p class="form-control-static"><b>Quantum demandé:</b> entre </p>
							</div>
							<div class="form-group">
								<div class="input-group">
									<input type="text" class="form-control input-sm" id="quantumD">
									<div class="input-group-addon">€</div>
								</div>
								<p class="form-control-static"> et </p>

								<div class="input-group">
									<input type="text" class="form-control input-sm" id="quantumD">
									<div class="input-group-addon">€</div>
								</div>
							</div>
							<button type="submit" class="btn btn-primary">Rechercher</button>
						</form>

					</div>

					<div id="tabQuantumResultat" class="tab-pane fade">
						<br>
						<form class="form-inline">
							<div class="form-group">
								<label class="sr-only"></label>
								<p class="form-control-static"><b>Quantum resultat:</b> entre </p>
							</div>
							<div class="form-group">
								<div class="input-group">
									<input type="text" class="form-control input-sm" id="quantumR">
									<div class="input-group-addon">€</div>
								</div>
								<p class="form-control-static"> et </p>

								<div class="input-group">
									<input type="text" class="form-control input-sm" id="quantumR">
									<div class="input-group-addon">€</div>
								</div>
							</div>
							<button type="submit" class="btn btn-primary">Rechercher</button>
						</form>
					</div>	
					<div id="tabResultats" class="tab-pane fade">
						<br>
						<div class="resultats">
							<div class="resultats checkbox">
								<label><input type="checkbox" value="accepte">accepté</label>
							</div>
							<div class="resultats checkbox">
								<label><input type="checkbox" value="rejette">rejetté</label>
							</div>
						</div>
						<button id="searchByResultat" type="button" class="btn btn-primary">Rechercher</button>
					</div>

				</div>
			</div>
		</div>
	</div>
</div>


<div class="btn-group" id="fltrCategories" style="display:none;">
	
	<button id="showCategories" class="btn btn-primary" >Categories</button> <!-- style="display:none;" -->
	<button id="editCategories"  title="Modifier" class="btn btn-info"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> </button> 
	<button id="removeCategories" title="Supprimer" class="btn  btn-info"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button>
	
</div>
<div class="btn-group" id="fltrVilles" style="display:none;">
	
	<button id="showVilles" class="btn btn-primary" >Villes</button> <!-- style="display:none;" -->
	<button id="editVilles"  title="Modifier" class="btn btn-info"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> </button> 
	<button id="removeVilles" title="Supprimer" class="btn  btn-info"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button>
	
</div>
<div class="btn-group" id="fltrQuantumD" style="display:none;">
	
	<button id="showQuantumD" class="btn btn-primary" >Quantum demandé</button> <!-- style="display:none;" -->
	<button id="editQuantumD" title="Modifier" class="btn btn-info"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> </button> 
	<button id="removeQuantumD" title="Supprimer" class="btn  btn-info"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button>
	
</div>

<div class="btn-group" id="filtrQuantumR" style="display:none;">						
	<button id="showQuantumR" class="btn btn-primary">Quantum resultat</button> <!-- style="display:none;" -->
	<button id="editQuantumR"  title="Modifier" class="btn btn-info"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> </button> 
	<button id="removeQuantumR" title="Supprimer" class="btn  btn-info"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button>
	
</div>

<div class="btn-group" id="fltrResultats" style="display:none;">
	<button id="showResultats" class="btn btn-primary" >Resultats</button> <!-- style="display:none;" -->
	<button id="editResultats"  title="Modifier" class="btn btn-info"> <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> </button> 
	<button id="removeResultats" title="Supprimer" class="btn  btn-info"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button>
	
</div>

<button id="clearAll" class="btn btn-primary" style="display:none;">Tout effacer</button> <!-- style="display:none;" -->

<br><br>

<div class="alert alert-info" id="resultat" style="display: none;" role="alert"></div>


<table class="table table-condensed text-center ">
	<thead>
		<td>RG</td>
		<td>Ville</td>
		<td>Juridiction</td>
		<td>Description</td>
		<td>Quantum demandé</td>
		<td>Quantum resultat</td>
		<td>Catégorie</td>
		<td>Resultat</td>

	</thead>
	<tbody id="tbody">
		{% for d in data %} 
		<tr>
			<td>{{d[1]}}</td>
			<td>{{d[2]}}</td>
			<td>{{d[3]}}</td>
			<td>{{d[4]}}</td>
			<td>{{d[6]}}</td>
			<td>{{d[7]}}</td>
			<td>{{d[8]}}</td>
			<td>{{d[9]}}</td>
		</tr>
		{% endfor %}
	</tbody>
</table>






<script type=text/javascript>

	document.getElementById("deselectAll").onclick = function() {deselectAll("categories")};
	document.getElementById("selectAll").onclick = function() {selectAll("categories")};
	document.getElementById("deselectAllV").onclick = function() {deselectAll("villes")};
	document.getElementById("selectAllV").onclick = function() {selectAll("villes")};

	document.getElementById("removeCategories").onclick = function() {
		deselectAll("categories");
		document.getElementById("searchByCategory").click();

	};

	document.getElementById("editCategories").onclick = function() {
		editFilters("categories");
	};

	document.getElementById("removeVilles").onclick = function() {
		deselectAll("villes");
		document.getElementById("searchByCity").click();

	};

	document.getElementById("editVilles").onclick = function() {
		editFilters("villes");	
	};

	document.getElementById("removeResultats").onclick = function() {
		deselectAll("resultats");
		document.getElementById("searchByResultat").click();

	};

	document.getElementById("editResultats").onclick = function() {
		editFilters("resultats");
		
	};

	function editFilters(type){
		var isExpanded = $("#filtres").attr("aria-expanded");
		
		if(isExpanded == 'false')
		{
			document.getElementById("showFiltres").click();
		}
		document.getElementById(type).click();

	}

	function deselectAll(type) {
		$('input:checkbox', "."+type).prop('checked', false);
	}


	function selectAll(type) {
		$('input:checkbox', "."+type).prop('checked', true);
	}

	categories = [];
	villes = [];
	quantumD = [];
	quantumR = [];
	resultats = [];
	
	$('#searchByResultat').click(function(){
		resultats = [];
		$("input[type=checkbox]:checked", ".resultats").each ( function() {
			console.log($(this).val());
			resultats.push($(this).val());

		});

		if(resultats.length == 0){
			document.getElementById("fltrResultats").style = "display:none";
		}else{
			document.getElementById("fltrResultats").style = "display:";
			
		}
		search();

	});

	$("#searchByCategory").click(function() {
		categories=[];
		
		$("input[type=checkbox]:checked", ".categories").each ( function() {
			console.log($(this).val());
			categories.push($(this).val());

		});
		console.log("categories.length "+categories.length);

		if(categories.length == 0){
			document.getElementById("fltrCategories").style = "display:none";
		}else{
			document.getElementById("fltrCategories").style = "display:";
			
		}

		search();

	});

	function search(){
		$.getJSON($SCRIPT_ROOT + '/search/', {
			categories: JSON.stringify(categories),
			villes: JSON.stringify(villes),
			quantumD: JSON.stringify(quantumD),
			quantumR: JSON.stringify(quantumR),
			resultat: JSON.stringify(resultats)
		}, function(data){
			var showRes = document.getElementById("resultat");
			
			if(data.result.length == 0){
				showRes.style="display: ;"
				showRes.innerHTML = "Désolé, aucun résultat ne correspond pas à votre recherche."
			}else{
				showRes.style="display: ;"
				showRes.innerHTML = "Voici <strong>"+ data.result.length+ "</strong> résultat(s) correspondant à votre recherche. "
				
			}
			updateTabel(data.result);
			console.log(data.result);
		        // $( "table" ).text(data.result);
		    });

	}

	$("#searchByCity").click(function() {
		villes=[];

		$("input[type=checkbox]:checked", ".villes").each ( function() {
			console.log($(this).val());
			villes.push($(this).val());

		});

		if(villes.length == 0){
			document.getElementById("fltrVilles").style = "display:none";
		}else{
			document.getElementById("fltrVilles").style = "display:";
			
		}
		search();
/*
		$.getJSON($SCRIPT_ROOT + '/searchByCity/', {
		        villes: JSON.stringify(villes)
		    }, function(data){
		    	updateTabel(data.result);
		        // $( "table" ).text(data.result);
		    });

		    */

		});

	function updateTabel(data){
		var tbody = $('#tbody');
		tbody.empty();
		console.log("updateTabel");
		data.forEach(function(decision) {
			var tr = $('<tr/>').appendTo(tbody);
			tr.append('<td>' + decision[1] + '</td>');
			tr.append('<td>' + decision[2] + '</td>');
			tr.append('<td>' + decision[3] + '</td>');
			tr.append('<td>' + decision[4] + '</td>');
			tr.append('<td>' + decision[6] + '</td>');
			tr.append('<td>' + decision[7] + '</td>');
			tr.append('<td>' + decision[8] + '</td>');
			tr.append('<td>' + decision[9] + '</td>');
			
		})
	};


</script>


{% endblock %}